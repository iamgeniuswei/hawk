{% load static %}
<html>
<head>
    {#    <meta charset="UTF-8">#}
    {#    <title>用户详细信息</title>#}
    {#    <style>#}
    {#        body {#}
    {#            margin-top: 3em;#}
    {#            background: #eee;#}
    {#            color: #555;#}
    {#            font-family: "Open Sans", "Segoe UI", Helvetica, Arial, sans-serif;#}
    {#        }#}
    {##}
    {#        p, p a {#}
    {#            font-value: 12px;#}
    {#            text-align: center;#}
    {#            color: #888;#}
    {#        }#}
    {#    </style>#}
    {#    <script src="echarts-all.js"></script>#}
    {#    <script src="js/drawl.js"></script>#}
</head>
<body>
<!-- 为ECharts准备一个具备大小（宽高）的Dom -->
<div style="padding:20px;width:100%;height:100%;">
    <!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
    <div id="main" style="width: 100%;height:2000px;">
    </div>
</div>
<!-- 进行ajax发送并接收数据,最后根据接收的数据完成可视化工作 -->
<script src="{% static 'jquery/jquery-3.5.1.js' %}"></script>
<script src="{% static 'echarts/echarts.js' %}" type="text/javascript" charset="utf-8"></script>
<script src="{% static 'echarts/extension/dataTool.js' %}" type="text/javascript" charset="utf-8"></script>
<script>
    var myChart = echarts.init(document.getElementById('main'));
    var categories = [{name: '作者'}, {name: '关键词'}]
    var nodes_raw = {{ nodes|safe }};
    var links_raw =
    {{ links|safe }}

    var nodes = nodes_raw.map(function (node) {
        return {
            name: node.name,
            value: node.value,
            category: node.category,
            symbolSize: node.value//支持度越大，节点越大
        };
    });

    //生成连线所需的数据对象
    var links = links_raw.map(function (node) {
        return {
            source: node.source,
            target: node.target,
            value: node.value,
            label: {
                normal: {
                    show: false,
                    formatter: function (x) {
                        return node.value;
                    }
                }
            },
            lineStyle: {
                normal: {
                    width: node.value,//可信度越高，连线越粗
                    color: 'source'
                }
            }

        };
    });


    option = {
        // 图的标题
        title: {
            text: 'ECharts 关系图'
        },
        // 提示框的配置
        tooltip: {
        },
        // 工具箱
        toolbox: {
            // 显示工具箱
            show: true,
            feature: {
                mark: {
                    show: true
                },
                // 还原
                restore: {
                    show: true
                },
                // 保存为图片
                saveAsImage: {
                    show: true
                }
            }
        },
        legend: [{
            // selectedMode: 'single',
            data: categories.map(function (a) {
                return a.name;
            })
        }],
        series: [{
            type: 'graph', // 类型:关系图
            layout: 'circular', //图的布局，类型为力导图
            focusNodeAdjacency: true,//当鼠标移动到节点上，突出显示节点以及节点的边和邻接节点
            draggable: true,//指示节点是否可以拖动
            roam: true, // 是否开启鼠标缩放和平移漫游。默认不开启。如果只想要开启缩放或者平移,可以设置成 'scale' 或者 'move'。设置成 true 为都开启
            {#edgeSymbol: ['circle', 'arrow'],#}
            {#edgeSymbolSize: [2, 10],#}
            symbolSize: function (value, params) {//改变节点大小
                if (value === 1)
                    return 20;
                else if (value === 2)
                    return 50;
                else
                    return 20;
            },
            edgeLabel: {
                normal: {
                    textStyle: {
                        fontSize: 20
                    }
                }
            },
            force: {
                repulsion: 200,
                gravity: 0.2,
                edgeLength: [100, 400],
            },
            itemStyle:{
                    normal: {
                        borderColor: '#fff',
                        borderWidth: 1,
                        shadowBlur: 10,
                    }

                },
            lineStyle: {
                normal: {
                    opacity: 0.9,
                    curveness: 0.3
                }
            },
            edgeLabel: {
                normal: {
                    show: false,
                    formatter: function (x) {
                        return x.data.name;
                    }
                }
            },
            label: {
                normal: {
                    show: true,
                    textStyle: {}
                }
            },

            // 数据
            data: nodes,
            links: links,
            categories: categories,
        }]
    };
    myChart.setOption(option);

</script>
</body>
</html>